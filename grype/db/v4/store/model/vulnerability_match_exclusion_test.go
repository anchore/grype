package model

import (
	"github.com/anchore/grype/grype/db/internal/sqlite"
	v4 "github.com/anchore/grype/grype/db/v4"
	"github.com/stretchr/testify/assert"
	"testing"
)

func TestVulnerabilityMatchExclusionModel_Inflate(t *testing.T) {
	tests := []struct {
		name   string
		record *VulnerabilityMatchExclusionModel
		result *v4.VulnerabilityMatchExclusion
	}{
		{
			name: "Nil constraint",
			record: &VulnerabilityMatchExclusionModel{
				PK:            0,
				ID:            "CVE-12345",
				Constraints:   sqlite.ToNullString(nil),
				Justification: "Who really knows?",
			},
			result: &v4.VulnerabilityMatchExclusion{
				ID:            "CVE-12345",
				Constraints:   nil,
				Justification: "Who really knows?",
			},
		},
	}

	for _, test := range tests {
		t.Run(test.name, func(t *testing.T) {
			result, err := test.record.Inflate()
			assert.NoError(t, err)
			assert.Equal(t, result, test.result)
		})
	}
}
